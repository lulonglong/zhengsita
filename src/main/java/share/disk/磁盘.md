## 简要介绍
本文档主要讲解磁盘的物理结构，逻辑结构，数据结构，以及部分存储原理



## 机械硬盘

磁盘（disk）是指利用磁记录技术存储数据的存储器

磁盘是计算机主要的存储介质，可以存储大量的二进制数据，并且断电后也能保持数据不丢失。早期计算机使用的磁盘是软磁盘（Floppy Disk，简称软盘），如今常用的磁盘是硬磁盘（Hard disk，简称硬盘）。

https://video.zhihu.com/video/1014788989630468096?player=%7B%22autoplay%22%3Afalse%2C%22shouldShowPageFullScreenButton%22%3Atrue%7D

![](https://yit-integration.oss-cn-hangzhou.aliyuncs.com/crm/tech/disk/%E7%A3%81%E7%9B%98%E7%89%A9%E7%90%86%E7%BB%93%E6%9E%84.jpg)

![](https://yit-integration.oss-cn-hangzhou.aliyuncs.com/crm/tech/disk/%E7%A1%AC%E7%9B%98%E7%94%B5%E8%B7%AF%E6%9D%BF.jpg)

### 物理结构

#### 磁盘盘片

​		盘片（disk）是硬盘中承载数据存储的介质。硬盘盘片是以坚固耐用的材料为盘基，将磁粉附着在铝合金(新材料也有用玻璃)圆盘片的表面上，表面被加工的相当平滑。这些磁粉被划分成称为磁道的若干个同心圆，在每个同心圆的磁道上就好像有无数的任意排列的小磁铁，它们分别代表着0和1的状态。当这些小磁铁受到来自磁头的磁力影响时，其排列的方向会随之改变。

#### 主轴电机与主轴

​	由主轴电机驱动主轴带动磁盘的转动

#### 音圈马达与磁头臂

​		永磁铁、音圈马达、磁头臂，三方结合驱动磁头切换磁道，以及进入磁头停泊区

#### 磁头停泊区

​		磁头停泊区是机械硬盘在不使用的状态，磁头不会放在存储区上面，而是无读取时将磁头放在停泊区。避免外部震荡造成磁头对磁盘划伤。



#### PCB板

![](https://yit-integration.oss-cn-hangzhou.aliyuncs.com/crm/tech/disk/%E7%A3%81%E7%9B%98%E5%8E%9F%E7%90%86%E5%9B%BE.jpeg)

​    PCB板上有各种控制电路，以及一下核心部件

​	Buffer Memory：高速缓存。

​	Interface Controller：接口控制器。

​	Micro-processor：微处理器。  

​	Servo Demodulator：伺服解调器。

​	Digital Signal Processor（DSP）：数字信号处理器。 

​	Positioning Driver：定位驱动器。  移动磁头到指定磁道

​	Spindle Driver：主轴驱动器。 控制主轴转动





#### 磁头：数据读写设备



![](https://yit-integration.oss-cn-hangzhou.aliyuncs.com/crm/tech/disk/%E7%A3%81%E5%A4%B4%E8%AF%BB%E5%86%99%E6%93%8D%E4%BD%9C.gif)

​																						MR磁头示意图



​		磁头是硬盘中最昂贵的部件，也是硬盘技术中最重要和最关键的一环。现在磁头常用的是采用分离式的磁头结构：写入磁头仍采用传统的磁感应磁头，读取磁头则采用磁阻磁头，即所谓的感应写、磁阻读。

![](https://yit-integration.oss-cn-hangzhou.aliyuncs.com/crm/tech/disk/GMR%E7%A3%81%E5%A4%B4%E7%BB%93%E6%9E%84.jpeg)

​																目前最常用的GMR磁头结构图



### 逻辑结构

#### 盘面*(Heads)*

<img src="https://yit-integration.oss-cn-hangzhou.aliyuncs.com/CRM/TECH/%E7%9B%98%E7%89%87.jpeg" style="zoom:80%;" />

​		硬盘的每一个盘片都有两个盘面，即上、下盘面，一般每个盘面都会利用，都可以存储数据，成为有效盘片，也有极个别的硬盘盘面数为单数。每一个这样的有效盘面都有一个盘面号 ，按顺序从上至下从“0”开始依次编号。在硬盘系统中， 盘面号又叫磁头号 ，因为每一个有效盘面都有一个对应的读写磁头。硬盘的盘片组在2～14片不等，通常有2～3个盘片，故盘面号（磁头号）为0～3或 0～5 

#### 磁道

​		磁盘在格式化时被划分成许多同心圆，这些同心圆轨迹叫做磁道（Track）。磁道从外向内从0开始顺序编号。硬盘的每一个盘面有300～1 024个磁道，新式大容量硬盘每面的磁道数更多。信息以脉冲串的形式记录在这些轨迹中，这些同心圆不是连续记录数据，而是被划分成一段段的圆弧，这些圆弧的角速度一样。由于径向长度不一样，所以，线速度也不一样，外圈的线速度较内圈的线速度大，即同样的转速下，外圈在同样时间段里，划过的圆弧长度要比内圈划过的圆弧长度大。每段圆弧叫做一个扇区，扇区从“1”开始编号，每个扇区中的数据作为一个单元同时读出或写入。一个标准的3.5in硬盘盘面通常有几百到几千条磁道。磁道是“看”不见的，只是盘面上以特殊形式磁化了的一些磁化区，在磁盘格式化时就已规划完毕。

#### 柱面*(Cylinder)*

![alt](https://yit-integration.oss-cn-hangzhou.aliyuncs.com/crm/tech/disk/%E6%9F%B1%E9%9D%A2.jpg)

​		所有盘面上的同一磁道构成一个圆柱，通常称做柱面（Cylinder），每个圆柱上的磁头由上而下从“0”开始编号。数据的读/写按柱面进行，即磁头读/写数据时首先在同一柱面内从“0”磁头开始进行操作，依次向下在同一柱面的不同盘面即磁头上进行操作，只在同一柱面所有的磁头全部读/写完毕后磁头才转移到下一柱面，因为选取磁头只需通过电子切换即可，而选取柱面则必须通过机械切换。电子切换相当快，比在机械上磁头向邻近磁道移动快得多，所以，数据的读/写按柱面进行，而不按盘面进行。也就是说，一个磁道写满数据后，就在同一柱面的下一个盘面来写，一个柱面写满后，才移到下一个扇区开始写数据。读数据也按照这种方式进行，这样就提高了硬盘的读/写效率。

一块硬盘驱动器的圆柱数（或每个盘面的磁道数）既取决于每条磁道的宽窄（同样，也与磁头的大小有关），也取决于定位机构所决定的磁道间步距的大小。

#### 扇区*(Sector)*

![](https://yit-integration.oss-cn-hangzhou.aliyuncs.com/crm/tech/disk/%E6%89%87%E5%8C%BA.jpg)

​		操作系统 以扇区（Sector）形式将信息存储在硬盘上， 每个扇区包括512个字节的数据和一些其他信息。一个扇区有两个主要部分：存储数据地点的标识符和存储数据的数据段。

标识符就是扇区头标，包括组成扇区三维地址的三个数字：扇区所在的磁头（或盘面）、磁道（或柱面号）以及扇区在磁道上的位置即扇区号。头标中还包括一个字段，其中有显示扇区是否能可靠存储数据，或者是否已发现某个故障因而不宜使用的标记。有些硬盘控制器在扇区头标中还记录有指示字，可在原扇区出错时指引磁盘转到替换扇区或磁道。最后，扇区头标以循环冗余校验（CRC）值作为结束，以供控制器检验扇区头标的读出情况，确保准确无误。

​		扇区的第二个主要部分是存储数据的数据段，可分为数据和保护数据的纠错码（ECC）。在初始准备期间，计算机用512个虚拟信息字节（实际数据的存放地）和与这些虚拟信息字节相应的ECC数字填入这个部分。

​		扇区头标包含一个可识别磁道上该扇区的扇区号。有趣的是，这些扇区号物理上并不连续编号，它们不必用任何特定的顺序指定。扇区头标的设计允许扇区号可以从1到某个最大值，某些情况下可达255。磁盘控制器并不关心上述范围中什么编号安排在哪一个扇区头标中。在很特殊的情况下，扇区还可以共用相同的编号。磁盘控制器甚至根本就不管数据区有多大，只管读出它所找到的数据，或者写入要求它写的数据。

​		系统将文件存储到磁盘上时，按柱面、磁头、扇区的方式进行，即最先是第1磁道的第一磁头下（也就是第1盘面的第一磁道）的所有扇区，然后，是同一柱面的下一磁头，……，一个柱面存储满后就推进到下一个柱面，直到把文件内容全部写入磁盘。系统也以相同的顺序读出数据。



#### 簇/块

​		通俗的来讲，在Windows下如NTFS等文件系统中叫做簇；在Linux下如Ext4等文件系统中叫做块（block）。

将物理相邻的若干个扇区称为了一个簇。操作系统读写磁盘的基本单位是扇区，而文件系统的基本单位是簇(Cluster)。在Windows下，随便找个几字节的文件，在其上面点击鼠标右键选择属性，看看实际大小与占用空间两项内容，如大小：15 字节 (15 字节)， 占用空间：4.00 KB (4，096 字节)。这里的占用空间就是你机器分区的簇大小，因为再小的文件都会占用空间，逻辑基本单位是4K，所以都会占用4K。 簇一般有这几类大小 4K，8K，16K，32K，64K等。簇越大存储性能越好，但空间浪费严重。簇越小性能相对越低，但空间利用率高。NTFS格式的文件系统簇的大小为4K。

##### **为什么存在磁盘块？**

​		读取方便：由于扇区的存储空间比较小，数目众多在寻址时比较困难，所以操作系统就将相邻的扇区组合在一起，形成一个块，再对块进行整体的操作。

​		分离对底层的依赖：操作系统忽略对底层物理存储结构的设计。通过虚拟出来磁盘块的概念，在系统中认为块是最小的单位。

#### 页

​		操作系统经常与内存和硬盘这两种存储设备进行通信，类似于“块”的概念，都需要一种虚拟的基本单位。所以，与内存操作，是虚拟一个页的概念来作为最小单位。与硬盘打交道，就是以块为最小单位。

### 数据结构

格式化好的硬盘,整个磁盘按所记录数据的作用不同可分为五部分：

#### **引导扇区(Boot Sector)**

![](https://yit-integration.oss-cn-hangzhou.aliyuncs.com/crm/tech/disk/%E5%BC%95%E5%AF%BC%E5%8C%BA.jpg)

磁盘设备的第一个扇区

位置：0柱面,0磁头,1扇区(clindyer 0,side 0,sector 1)

包括：主引导记录MBR(Main Boot Record)和分区表DPT(Disk Partition Table).

##### (1)主引导记录MBR(MBR)

功能：检查分区表是否正确以及确定哪个分区为引导分区,并在程序结束时把该分区的启动程序(也就是操作系统引导扇区)调入内存加以执行.

注意：MBR是由分区程序(例如DOS的Fdisk.exe)产生的,不同的操作系统可能这个扇区是不尽相同.如果你有这个意向也可以自己去编写一个,只要它能完成前述的任务即可,这也是为什么能实现多系统启动的原因(说句题外话:正因为这个主引导记录容易编写,所以才出现了很多的引导区病毒).

##### (2)硬盘分区表(DPT)

大小:总共64字节(01BE–01FD)

每个分区占16个字节,所以可以表示四个分区,这也就是为什么一个磁盘的主分区和扩展分区之和总共只能有四个的原因.

详情：

扩展分区的信息位于以上所示的硬盘分区表(DPT)中,而逻辑驱”动器的信息则位于扩展分区的起始扇区,即该分区的起始地址(面/扇区/磁道)所对应的扇区,该扇区中的信息与硬盘主引导扇区的区别是不包含MBR,而16字节的分区信息则表示的是逻辑驱动器的起始和结束地址等.



#### 操作系统引导记录(OBR——OS Boot Record)

​		它通常位于硬盘的0磁道1柱面1扇区，是操作系统可以直接访问的第一个扇区，它包括一个引导程序和一个被称为BPB（Bios Parameter Block）的本分区参数记录表。

#### 文件分配表(FAT——File Assign Table)

​		为了实现文件的链式存储，硬盘上必须准确地记录哪些簇已经被文件占用，还必须为每个已经占用的簇指明存储后继内容的下一个簇的簇号。对一个文件的最后一簇，则要指明本簇无后继簇。这些都是由FAT表来保存的，表中有很多表项，每项记录一个簇的信息。由于FAT对于文件管理的重要性，所以FAT有一个备份，即在原FAT的后面再建一个同样的FAT。初形成的FAT中所有项都标明为“未占用”，但如果磁盘有局部损坏，那么格式化程序会检测出损坏的簇，在相应的项中标为“坏簇”，以后存文件时就不会再使用这个簇了。FAT的项数与硬盘上的总簇数相当，每一项占用的字节数也要与总簇数相适应，因为其中需要存放簇号。FAT的格式有多种，最为常见的是FAT16和FAT32。

#### 根目录(DIR——Directory)

​		DIR（Directory）是根目录区，紧接着第二个FAT表（即备份的FAT表）之后，记录着根目录下每个文件(目录)的起始单元，文件的属性等。定位文件位置时，操作系统根据DIR中的起始单元，结合FAT表就可以知道文件在硬盘中的具体位置和大小了

#### 数据区(DATA)

​		二级目录的目录结构与文件描述信息，以及文件具体数据，皆存在此区域。

​		数据区是真正意义上的数据存储的地方，位于DIR区之后，占据硬盘上的大部分数据空间。

前5个重要信息在磁盘的外磁道上,原因是外圈周长总大于内圈周长,也即外圈存储密度要小些,可靠性高些.

其中只有主引导扇区是唯一的,其它的随你的分区数的增加而增加.



### 硬盘读写数据的过程

​		硬盘读取数据时，读写磁头沿径向移动，移到要读取的扇区所在磁道的上方，这段时间称为寻道时间(seek time)。因读写磁头的起始位置与目标位置之间的距离不同，寻道时间也不同。目前硬盘一般为2到30毫秒，平均约为9毫秒。磁头到达指定磁道后，然后通过盘片的旋转，使得要读取的扇区转到读写磁头的下方，这段时间称为旋转延迟时间(rotational latencytime)。

一个7200（转/每分钟）的硬盘，每旋转一周所需时间为60×1000÷7200=8.33毫秒，则平均旋转延迟时间为8.33÷2=4.17毫秒（平均情况下，需要旋转半圈）。平均寻道时间和平均旋转延迟称为平均存取时间。



## 固态硬盘（SSD）

​		固态硬盘和传统的机械硬盘最大的区别就是不再采用盘片进行数据存储，而采用存储芯片进行数据存储。固态硬盘的存储芯片主要分为两种：一种是采用闪存作为存储介质的；另一种是采用DRAM作为存储介质的。目前使用较多的主要是采用闪存作为存储介质的固态硬盘。

![](https://yit-integration.oss-cn-hangzhou.aliyuncs.com/crm/tech/disk/%E5%9B%BA%E6%80%81%E7%A1%AC%E7%9B%98.jpg

![](https://yit-integration.oss-cn-hangzhou.aliyuncs.com/crm/tech/disk/SSD.jpg)

### 读写原理

​		相较于机械硬盘里面的复杂结构，固态硬盘就要简单许多。它主要是靠FLASH芯片来作为储存数据的介质，由主控芯片来承担数据的中转，并调配数据储存在闪存芯片上面。		

![](https://yit-integration.oss-cn-hangzhou.aliyuncs.com/crm/tech/disk/%E5%9B%BA%E6%80%81%E7%A1%AC%E7%9B%98%E5%AD%98%E5%82%A8%E5%8D%95%E5%85%83.jpg)



​		闪存的基本存储单元是浮栅晶体管，其中的浮栅被二氧化硅包裹，和上下绝缘，在断电时也能够保存电子，当电子数量高于一个中间值就表示0，低于中间值就表示1。



![](https://yit-integration.oss-cn-hangzhou.aliyuncs.com/crm/tech/disk/%E5%9B%BA%E6%80%81%E7%A1%AC%E7%9B%98%E5%AD%98%E5%82%A8%E5%8D%95%E5%85%832.jpg)

​		晶体管每次写入数据前都要先擦除，在P极上加一个电压，浮栅中原有的电子会因为量子隧穿效应通过绝缘层被吸出来，让浮栅中的电子数量低于中间值，还原成1；如果要写入0，就在控制极加一个电压，让电子穿过绝缘层再注回浮栅，使电子数量高于中间值，表示0。



### 芯片晶圆及晶体颗粒



![](https://yit-integration.oss-cn-hangzhou.aliyuncs.com/crm/tech/disk/die.jpeg)



![(https://yit-integration.oss-cn-hangzhou.aliyuncs.com/crm/tech/disk/%E5%AE%9E%E7%89%A9%E6%99%B6%E5%9C%86%E6%94%BE%E5%A4%A7%E5%9B%BE.jpeg)



![](https://yit-integration.oss-cn-hangzhou.aliyuncs.com/crm/tech/disk/die%E6%94%BE%E5%A4%A7%E5%9B%BE.jpeg)

![](https://yit-integration.oss-cn-hangzhou.aliyuncs.com/crm/tech/disk/NAND%20Flash%20%E6%99%B6%E5%9C%86.jpg)